$y_i$ - результат измерения
$x_i$ - прочие переменные 

Когда мы разбиваем наших пользователей на выборки, у нас пользователь попадает либо в контрольную, либо в тестовую группу. Однако нас также интересует тот результат, которые принесли наши внедрения по каждому пользователю. Но мы не можем опять же такой результат получить, так как  у нас пользователь либо в тестовой выборке, либо в контрольной.  Поэтому и есть ATE. 

ATE = $E(y_i(1) - y_i(0))$  

И эту штуку мы пытаемся в А/Б тесте оценить. 

`CATE (Conditional Average Treatment Effect)` в контексте A/B тестов — это метрика, которая измеряет средний эффект воздействия (например, новой функции или изменения) на определённую подгруппу пользователей. В отличие от ATE (Average Treatment Effect), который оценивает средний эффект на всю популяцию, CATE фокусируется на среднем эффекте в зависимости от определённых характеристик или условий.

Но по сути, мы можем посчитать разность между $E(y_i(1)) - E(y_i(0))$ .  То есть просто разность между мат.ожиданием тестовой и контрольной выборки. 

Если мы будем раскрывать это дальше : 

$$
E(y_i | d_i= 1) - E(y_i | d_i = 0) = E(y_i(1) | d_i= 1) - E(y_i(0) | d_i = 0)  =  E(y_i(1) | d_i= 1) - E(y_i(0) | d_i = 1)  +  E(y_i(0) | d_i= 1) - E(y_i(0) | d_i = 0) =  E(y_i(1)  - y_i(0))| d_i= 1) - E(y_i(0) | d_i = 0) - E(y_i(0) | d_i = 1)
$$

И вот последнее, что у нас получилось , а именно 

$$
E(y_i(1)  - y_i(0)| d_i= 1) - E(y_i(0) | d_i = 0) - E(y_i(0) | d_i = 1)
$$

Первая штука  $E(y_i(1)  - y_i(0)| d_i= 1)$  это ATET . Средний эффект воздействия на тех, кто ему подвергся. 

А вот второе слогаемое ( $E(y_i(0) | d_i = 0) - E(y_i(0) | d_i = 1)$ ) это Selection Bias (SB) или смещение из-за самоотбора. То есть здесь на примере лекарства : 

$y_i(1)$ - здоровье если бахнул лекарство 
$y_i(0)$ - здоровье если не стал бахать лекарство 

Дак в selection bias люди сами решают, пить или не пить лекарство. Именно в таком случае selection bias и получается. 

При этом, если выборка полностью рандомизирована,  то тогда все будет норм

Однако, такая проблема может появиться из-за сетевого эффекта. Это когда пользователь, влияет на выбор другого пользователя. Например есть Егор и Маша. Они любят другому , а мы тестим цены на такси. И получилось так, что цена на такси у Егора и Маши разные так как мы тестим эластичность цены. Маша попала с тестовую выборку, а Егор в контрольную. Так как у Егора дешевле, они поехали на одной машине. То есть здесь перешел самоотбор, то есть Маша сама решила, в какую группу она попадет. 

И с selecion bias можно бороться по-разному. Например switchack. Это когда мы рандомно меняем режим эксперемента. 


