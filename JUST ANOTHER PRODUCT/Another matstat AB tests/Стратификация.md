Стратификация - это один из способов понижения `SE`.

Предположим , мы проводим аб тест на наших пользователях. Отметим, что у нас есть программа лояльности. И у нас есть информация, какие пользователи зарегистрированы в программе , а какие нет. 

**Ковариата** - метрика, которая коррелирует с целевой метрикой, может быть измерена до эксперимента (строго говоря, нет) и не зависит от других экспериментов. В нашем случае факт регистрации в программе лояльности до эксперимента будет ковариатой. То есть ковариарта - это то, по какому признаку идет стратификация. 

С помощью ковариат можно разделить популяцию на непересекающиеся подмножества, которые будут обладать уникальным набором значений ковариат. Такие подмножества будем называть **стратами**.

В нашем примере будет две страты:

- первая - кто не зарегистрирован в программе лояльности;
- вторая - кто зарегистрирован в программе лояльности.

Посмотрим на исторические данные пользователей этих страт по отдельности. Допустим, мы выяснили, следующую информацию:

- доли страт в популяции равны и составляют 50%;
- средняя выручка за неделю в первой страте равна 2000 рублей, во второй - 3000 рублей;
- стандартные отклонения выручки за неделю равны 625 рублей в обеих стратах. При таких значениях отклонений объединение данных обеих страт будет иметь отклонение около 800 рублей, как было изначально.

![[Pasted image 20240730210141.png]]

Получается, пользователи разных страт имеют разные распределения метрики.

К чему это может привести? Как мы знаем, когда мы рандомно разбиваем выборку, то может получиться так, что количество пользователей первой страты в контрольной группе может оказаться больше чем в экспериментальной, и наоборот. Это может привести к неверным результатам при оценке пилота, так как средние значения метрики в стратах отличаются.

