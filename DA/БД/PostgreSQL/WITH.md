WITH в SQL используется для создания временной именованной подзапросной таблицы, также известной как Common Table Expression (CTE), что делает код более читаемым и удобным для повторного использования подзапросов. Он позволяет писать сложные запросы, разбивая их на части и структурируя код.

  

**Пример использования**

  

WITH Sales_CTE AS (

    SELECT product_id, SUM(quantity) AS total_quantity

    FROM sales

    GROUP BY product_id

)

SELECT product_id, total_quantity

FROM Sales_CTE

WHERE total_quantity > 100;

  

В этом примере:

1. Сначала с помощью WITH создается CTE Sales_CTE, которая группирует данные по product_id и считает total_quantity.

2. Затем основной запрос выбирает данные из Sales_CTE, применяя к ним фильтр.

  

**Преимущества использования WITH**

  

• Повышает читабельность, избегая дублирования кода.

• Упрощает работу с промежуточными вычислениями.

• Полезен для разбивки сложных запросов на логические блоки, что также упрощает отладку.